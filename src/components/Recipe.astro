---
import Chip from "./Chip.astro"
import { Image } from "astro:assets"
import { FaRegStickyNote } from "react-icons/fa"
import "./recipe.scss"

interface Props {
  image?: any
  source?: string
  tags?: string[]
  title: string
  tagFilters: string[]
  notes?: string
  type?: string
  slug?: string
}

const {
  image,
  source,
  tags = [],
  title,
  tagFilters = [],
  notes,
  type,
  slug,
} = Astro.props

const capitalizeTitle = (title = "") =>
  title
    .split(" ")
    .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
    .join(" ")

const tagFiltersSet = new Set(tagFilters)
---

<div class="recipe fade-in">
  <h2 class="recipe__title">
    {capitalizeTitle(title)}
    {
      notes && notes.trim() !== "" && (
        <span
          class="recipe__note-icon"
          data-tooltip={notes}
          role="button"
          tabindex="0"
        >
          <FaRegStickyNote />
        </span>
      )
    }
  </h2>
  <div class="recipe__body">
    {
      image &&
        (type === "custom-recipe" ? (
          <a href={slug} class="recipe__link">
            <Image
              src={image}
              alt={title}
              class="recipe__image"
              width={600}
              height={400}
              format="webp"
              loading="lazy"
            />
          </a>
        ) : (
          <a
            href={source}
            target="_blank"
            rel="nofollow noopener noreferrer"
            class="recipe__link"
          >
            <Image
              src={image}
              alt={title}
              class="recipe__image"
              width={600}
              height={400}
              format="webp"
              loading="lazy"
            />
          </a>
        ))
    }
    <div class="recipe__body__chips">
      {
        tags &&
          tags
            .sort()
            .map((tag) => (
              <Chip
                label={tag}
                data-tag={tag}
                active={tagFiltersSet.has(tag)}
              />
            ))
      }
    </div>
  </div>
</div>

<style>
  .recipe__note-icon {
    position: relative;
    cursor: pointer;
    margin-left: 0px;
    display: inline-flex;
    align-items: center;
    vertical-align: middle;
    transform: translateY(-5px);
  }

  .recipe__note-icon::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 125%;
    left: 50%;
    transform: translateX(-50%);
    background-color: rgba(97, 97, 97, 0.92);
    color: white;
    padding: 8px 12px;
    border-radius: 4px;
    white-space: normal;
    width: 250px;
    font-size: 0.875rem;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
    z-index: 1000;
  }

  .recipe__note-icon:hover::after,
  .recipe__note-icon:focus::after {
    opacity: 1;
  }
</style>
