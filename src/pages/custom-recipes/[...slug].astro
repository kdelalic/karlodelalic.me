---
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import '../_custom-recipe.scss';

export async function getStaticPaths() {
  const recipes = await getCollection('recipes');
  const customRecipes = recipes.filter(recipe => recipe.data.type === 'custom-recipe');

  return customRecipes.map(recipe => ({
    params: { slug: recipe.slug },
    props: { recipe },
  }));
}

interface Props {
  recipe: CollectionEntry<'recipes'>;
}

const { recipe } = Astro.props;
const { Content } = await recipe.render();

const imageSrc = recipe.data.image
  ? `/recipes/${recipe.slug}/${recipe.data.image.src.split('/').pop()}`
  : null;
---

<BaseLayout title={recipe.data.title}>
  <Header slot="header" />
  <div class="custom-recipe">
    <article>
      {imageSrc && <img src={imageSrc} alt={recipe.data.title} />}
      <h2>Ingredients</h2>
      {recipe.data.ingredients && (
        <ul>
          {recipe.data.ingredients.map((item) => (
            <li>{item}</li>
          ))}
        </ul>
      )}
      <h2>Steps</h2>
      <div class="steps">
        <Content />
      </div>
      {recipe.data.notes && (
        <>
          <h2>Notes</h2>
          <div class="notes" set:html={recipe.data.notes} />
        </>
      )}
    </article>
  </div>
</BaseLayout>
